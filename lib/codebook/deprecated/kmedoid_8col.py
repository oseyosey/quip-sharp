"""
Rounds to the grid [-1.5, -0.5, 0.5, 1.5]
"""

import torch
from torch import nn

from lib.utils.matmul_had import matmul_hadU_cuda, matmul_hadUt_cuda

_KM8C_CODESZ = 8


def get_abs_grid():
    return torch.tensor([[
        7.473278e-01, 5.762376e-01, 2.220120e+00, 1.387988e+00, 1.740382e-01, 5.697557e-01,
        2.656273e-01, 4.170982e-01
    ],
                         [
                             9.290196e-01, 3.158202e-01, 4.983571e-01, 1.042168e+00, 1.364819e+00,
                             8.314505e-01, 5.942200e-01, 7.207082e-01
                         ],
                         [
                             3.294619e-01, 1.725864e+00, 8.179841e-02, 9.259188e-01, 5.637701e-01,
                             7.320022e-02, 1.804897e+00, 4.301579e-01
                         ],
                         [
                             7.055790e-01, 5.635450e-01, 8.136130e-01, 1.282676e+00, 3.722317e-01,
                             5.901588e-01, 1.558898e+00, 4.165269e-02
                         ],
                         [
                             2.526926e-01, 4.482289e-01, 6.582088e-01, 5.675563e-01, 4.371354e-01,
                             1.220274e+00, 7.083759e-02, 1.194934e+00
                         ],
                         [
                             5.707353e-01, 2.386170e-01, 6.197837e-01, 6.378630e-01, 8.797548e-01,
                             3.202535e-01, 1.121404e+00, 6.326787e-01
                         ],
                         [
                             1.872124e+00, 8.266838e-01, 3.577428e-01, 2.912577e-01, 1.020242e-01,
                             9.230135e-01, 1.995450e-01, 4.290076e-01
                         ],
                         [
                             1.410940e+00, 1.397377e+00, 1.685387e+00, 5.921840e-01, 4.371102e-01,
                             5.885633e-01, 1.876658e-01, 9.287606e-01
                         ],
                         [
                             4.919621e-01, 1.305790e+00, 2.409980e-01, 1.138808e+00, 4.149091e-01,
                             1.401218e-01, 7.712708e-01, 2.120399e-01
                         ],
                         [
                             6.957898e-01, 2.026956e+00, 7.708722e-01, 4.122202e-01, 3.659434e-02,
                             1.026017e+00, 1.255762e+00, 1.712045e+00
                         ],
                         [
                             3.225826e-01, 6.696737e-03, 1.498791e+00, 3.796315e-01, 1.161210e+00,
                             1.339675e+00, 1.118933e+00, 6.328924e-01
                         ],
                         [
                             6.991369e-01, 1.410318e+00, 1.426585e+00, 1.146917e+00, 1.470750e+00,
                             2.437127e-01, 1.691956e+00, 5.356819e-01
                         ],
                         [
                             6.323530e-01, 1.003142e+00, 9.841165e-01, 4.909715e-01, 3.607017e-01,
                             9.458073e-01, 1.174022e+00, 1.285408e+00
                         ],
                         [
                             6.371675e-01, 2.016612e+00, 8.286242e-01, 5.326093e-01, 1.553732e+00,
                             3.268205e-01, 5.131375e-01, 4.580465e-01
                         ],
                         [
                             1.125778e+00, 8.159388e-01, 7.381527e-01, 6.976711e-01, 1.018410e+00,
                             2.360745e+00, 6.099050e-01, 1.401242e+00
                         ],
                         [
                             6.684548e-01, 1.430570e+00, 8.485147e-01, 1.763626e+00, 9.961440e-01,
                             3.845900e-01, 2.801108e-01, 1.402608e+00
                         ],
                         [
                             1.354800e+00, 5.048486e-01, 1.514370e+00, 7.055071e-01, 2.898028e-01,
                             6.255621e-01, 1.986427e+00, 1.218728e+00
                         ],
                         [
                             1.713683e+00, 5.716659e-01, 3.786611e-01, 9.676958e-02, 6.199044e-01,
                             3.856945e-01, 1.357854e-01, 1.469427e+00
                         ],
                         [
                             3.358812e-01, 8.176787e-01, 2.654935e-01, 4.158384e-01, 1.113009e-01,
                             1.966543e+00, 1.312464e+00, 1.957600e-01
                         ],
                         [
                             1.531668e+00, 9.442884e-01, 3.244192e-01, 1.418552e+00, 3.327050e-01,
                             3.522762e-02, 1.472009e+00, 1.310030e+00
                         ],
                         [
                             1.064791e+00, 4.802268e-01, 6.226937e-01, 1.309805e+00, 8.652639e-02,
                             9.458669e-01, 1.144935e+00, 2.231319e+00
                         ],
                         [
                             8.848678e-01, 6.846001e-01, 4.138755e-01, 5.268005e-01, 4.546203e-01,
                             6.431339e-01, 7.122502e-01, 3.282406e-01
                         ],
                         [
                             6.868107e-01, 3.514447e-01, 8.365706e-01, 6.754988e-01, 1.231301e+00,
                             3.658296e-02, 4.847824e-01, 1.745142e+00
                         ],
                         [
                             6.024902e-01, 7.406917e-01, 1.152332e+00, 8.784692e-01, 9.708089e-02,
                             3.756193e-01, 2.097097e-01, 6.233608e-01
                         ],
                         [
                             1.179159e+00, 7.759435e-01, 9.700485e-01, 9.895589e-01, 1.870682e-01,
                             1.680137e+00, 3.866623e-02, 4.435210e-01
                         ],
                         [
                             1.075916e+00, 7.789657e-01, 2.886544e-01, 3.839939e-01, 1.776930e+00,
                             7.193335e-01, 3.817213e-01, 4.517240e-01
                         ],
                         [
                             2.675582e-01, 5.017400e-01, 6.039787e-01, 1.089657e+00, 7.442688e-01,
                             5.084207e-01, 8.047583e-01, 1.420486e+00
                         ],
                         [
                             2.117126e+00, 4.780044e-01, 8.544608e-01, 1.131043e+00, 7.257444e-01,
                             6.419181e-01, 3.902103e-01, 7.061194e-01
                         ],
                         [
                             2.841764e-02, 1.386109e+00, 4.806871e-01, 4.199111e-01, 1.009320e+00,
                             1.152631e+00, 7.720602e-01, 8.676179e-01
                         ],
                         [
                             7.663103e-01, 7.684723e-01, 6.605548e-01, 2.384752e+00, 3.555775e-01,
                             7.685265e-01, 1.839418e-01, 1.166876e+00
                         ],
                         [
                             2.587706e-01, 4.727576e-01, 1.944710e+00, 5.225842e-01, 3.164238e-01,
                             2.678013e-01, 1.030980e+00, 4.977527e-01
                         ],
                         [
                             1.089217e+00, 3.816129e-01, 9.199896e-01, 1.412692e+00, 6.320645e-01,
                             7.921222e-01, 1.469278e+00, 4.857458e-01
                         ],
                         [
                             2.922362e-01, 3.986195e-01, 9.958589e-01, 1.130881e+00, 1.727512e+00,
                             6.395881e-01, 8.147246e-01, 6.034642e-02
                         ],
                         [
                             8.727677e-01, 1.395017e+00, 1.334147e-02, 4.565814e-01, 4.419107e-01,
                             9.213212e-01, 6.819183e-01, 3.520817e-01
                         ],
                         [
                             7.706333e-01, 9.130744e-01, 1.815298e+00, 6.344188e-03, 3.646456e-01,
                             6.492540e-01, 5.441260e-01, 3.288348e-01
                         ],
                         [
                             5.770357e-01, 3.155366e-01, 8.035075e-01, 6.635951e-01, 2.947181e-01,
                             3.306707e-01, 2.246231e+00, 1.665592e+00
                         ],
                         [
                             7.885624e-02, 8.403075e-01, 1.542236e+00, 5.951721e-01, 5.854821e-01,
                             4.173582e-01, 2.762614e-01, 2.718055e+00
                         ],
                         [
                             4.065466e-01, 1.139133e+00, 1.660553e+00, 6.596047e-01, 1.134980e+00,
                             1.417519e+00, 5.753034e-01, 7.851262e-01
                         ],
                         [
                             1.502350e+00, 6.183178e-01, 2.463345e-01, 9.596422e-02, 1.248034e+00,
                             1.069140e+00, 1.388835e+00, 9.853132e-01
                         ],
                         [
                             6.223049e-01, 8.621851e-01, 1.383277e+00, 2.011790e+00, 9.532442e-01,
                             2.139635e+00, 8.377779e-01, 1.191816e+00
                         ],
                         [
                             1.084855e+00, 1.148617e+00, 1.051348e-01, 5.771652e-01, 8.901139e-01,
                             1.824105e+00, 3.380922e-01, 1.824711e-01
                         ],
                         [
                             9.308904e-01, 2.174860e-01, 5.960158e-01, 1.486877e-01, 4.127505e-01,
                             1.138561e+00, 2.885469e+00, 9.499589e-01
                         ],
                         [
                             2.119330e+00, 1.052463e+00, 9.930999e-01, 1.031405e+00, 1.628508e+00,
                             4.080710e-01, 1.222956e+00, 1.089130e-01
                         ],
                         [
                             2.214738e+00, 6.221959e-01, 7.063547e-01, 9.761962e-01, 2.102394e-01,
                             1.575101e+00, 1.548691e+00, 5.987461e-01
                         ],
                         [
                             7.223387e-02, 6.995364e-01, 8.940777e-01, 2.266345e-01, 1.626945e-01,
                             7.544403e-01, 1.026182e+00, 3.006712e-01
                         ],
                         [
                             5.037812e-02, 5.911012e-01, 9.384809e-01, 3.381075e-01, 4.049925e-01,
                             1.707238e+00, 3.140480e-01, 2.404670e-01
                         ],
                         [
                             4.752432e-01, 8.336203e-01, 9.004947e-01, 2.510917e+00, 8.813518e-01,
                             4.226944e-01, 6.587970e-01, 5.845435e-01
                         ],
                         [
                             1.613030e+00, 1.924646e+00, 5.191876e-01, 7.735146e-01, 5.966383e-01,
                             1.605722e+00, 4.585049e-01, 8.173469e-01
                         ],
                         [
                             6.207449e-01, 5.620269e-01, 3.388620e-01, 7.745970e-01, 1.365731e-01,
                             1.963937e-01, 4.376639e-01, 8.903533e-01
                         ],
                         [
                             4.742890e-01, 1.174927e+00, 6.454593e-01, 1.830937e-01, 3.763154e-01,
                             2.002788e-01, 1.912379e+00, 2.737485e-01
                         ],
                         [
                             1.375303e+00, 2.019416e+00, 2.888258e-01, 8.855847e-01, 5.406691e-01,
                             2.160405e-01, 1.072966e+00, 8.969010e-01
                         ],
                         [
                             8.399292e-01, 1.613728e+00, 6.708620e-01, 6.263860e-01, 9.082811e-01,
                             7.025669e-01, 2.731897e-01, 1.980958e-01
                         ],
                         [
                             6.662800e-01, 8.927447e-01, 2.741368e-01, 4.980071e-01, 4.020607e-01,
                             2.190111e-01, 2.953293e-01, 8.945213e-01
                         ],
                         [
                             6.099057e-01, 4.683205e-02, 1.347619e+00, 6.019989e-01, 6.325896e-01,
                             4.463990e-01, 3.979244e-01, 5.369148e-01
                         ],
                         [
                             1.197126e+00, 1.737976e-01, 1.225437e+00, 2.400617e-01, 1.833712e+00,
                             3.874011e-01, 3.509079e-01, 2.091089e-01
                         ],
                         [
                             6.525165e-01, 1.646492e-01, 3.676394e-01, 6.290568e-01, 1.014751e+00,
                             1.678074e+00, 8.117926e-01, 3.985724e-01
                         ],
                         [
                             2.579505e-01, 8.832721e-01, 3.640305e-01, 1.298982e+00, 4.062807e-01,
                             7.443692e-01, 1.228707e-01, 5.354204e-01
                         ],
                         [
                             7.927384e-01, 1.267244e+00, 1.165931e+00, 5.912930e-01, 2.345815e+00,
                             1.703462e+00, 3.981949e-01, 4.009659e-01
                         ],
                         [
                             9.084496e-01, 5.695733e-01, 9.242886e-01, 1.628899e+00, 8.593253e-02,
                             1.222655e+00, 8.505659e-01, 7.957733e-01
                         ],
                         [
                             3.365978e-01, 7.963228e-01, 5.226485e-01, 2.201495e-01, 1.457647e+00,
                             1.492396e+00, 1.557600e+00, 5.266734e-01
                         ],
                         [
                             2.198969e-01, 4.888034e-01, 3.327133e-01, 3.959224e-01, 1.133653e+00,
                             4.006033e-01, 3.350695e-01, 9.014000e-02
                         ],
                         [
                             1.283784e+00, 2.467386e-01, 7.706242e-01, 4.974719e-01, 5.233619e-01,
                             6.851900e-01, 1.308897e-01, 9.593201e-01
                         ],
                         [
                             1.961718e-01, 2.962447e-01, 6.216175e-01, 9.070570e-01, 1.461785e-01,
                             8.079147e-01, 1.205906e+00, 8.496213e-01
                         ],
                         [
                             4.431788e-01, 3.934406e-01, 2.025227e+00, 1.280781e+00, 5.010996e-01,
                             5.069425e-01, 5.258588e-01, 1.050676e+00
                         ],
                         [
                             5.054775e-01, 6.626484e-01, 3.486135e-01, 7.256073e-01, 2.300197e+00,
                             1.073768e+00, 1.011641e+00, 1.160028e+00
                         ],
                         [
                             4.703388e-01, 2.168501e+00, 4.115212e-01, 3.591425e-01, 1.648034e-01,
                             2.961949e-01, 2.792227e-01, 6.347678e-01
                         ],
                         [
                             5.970840e-01, 1.867043e+00, 9.722559e-01, 1.457970e+00, 2.847175e-01,
                             1.702560e+00, 4.962565e-01, 9.179702e-01
                         ],
                         [
                             5.119973e-01, 1.506321e+00, 4.636186e-01, 1.900397e+00, 1.834590e+00,
                             1.208948e+00, 9.140914e-01, 1.987920e+00
                         ],
                         [
                             5.088260e-01, 6.122609e-01, 1.253809e+00, 5.479834e-01, 1.066979e+00,
                             4.246934e-01, 1.118007e+00, 1.161154e+00
                         ],
                         [
                             1.476884e+00, 1.039684e+00, 4.330362e-01, 6.491596e-01, 5.120292e-01,
                             8.474298e-01, 2.052592e+00, 1.395834e+00
                         ],
                         [
                             1.914298e+00, 4.048897e-01, 1.141808e+00, 3.163166e-02, 1.322582e+00,
                             1.117787e+00, 7.327058e-01, 1.868799e+00
                         ],
                         [
                             6.498666e-01, 2.687624e-01, 9.693695e-01, 9.368026e-01, 1.275132e+00,
                             1.348863e+00, 1.727708e+00, 2.062978e-03
                         ],
                         [
                             6.874343e-01, 1.658689e+00, 1.112051e+00, 1.069620e+00, 9.144331e-01,
                             6.462089e-01, 9.359192e-01, 5.289437e-01
                         ],
                         [
                             7.615310e-01, 1.182650e+00, 2.279061e-01, 2.095103e+00, 1.037122e+00,
                             3.317149e-01, 7.456193e-01, 7.955711e-01
                         ],
                         [
                             4.579808e-01, 7.099506e-01, 2.256042e+00, 6.918383e-01, 5.036850e-01,
                             2.230290e+00, 8.681354e-01, 5.797523e-02
                         ],
                         [
                             1.262731e+00, 1.081657e+00, 3.930454e-01, 7.252777e-01, 1.550545e+00,
                             6.860732e-01, 8.158240e-01, 1.455285e+00
                         ],
                         [
                             2.465706e-01, 1.370313e+00, 1.792354e+00, 1.538486e-01, 2.076981e+00,
                             6.308111e-01, 2.640066e-01, 1.780810e+00
                         ],
                         [
                             1.572832e+00, 7.451174e-01, 5.262970e-02, 1.575181e+00, 1.258450e-01,
                             1.143112e-01, 3.900380e-01, 8.871811e-01
                         ],
                         [
                             1.035510e+00, 2.146404e-01, 2.038511e+00, 4.978440e-01, 7.142961e-01,
                             1.220036e+00, 9.307569e-01, 1.232389e+00
                         ],
                         [
                             1.360658e+00, 7.047310e-01, 5.098537e-01, 1.084417e+00, 8.259183e-01,
                             2.089025e-01, 8.861194e-01, 5.926622e-01
                         ],
                         [
                             5.570572e-01, 1.506234e+00, 5.981862e-01, 1.531669e+00, 6.864728e-01,
                             1.355609e+00, 2.445807e+00, 1.168701e+00
                         ],
                         [
                             2.013588e+00, 1.326285e+00, 1.133033e+00, 3.747868e-01, 7.061924e-01,
                             1.606683e-01, 1.035911e+00, 1.364816e+00
                         ],
                         [
                             8.823657e-01, 8.173530e-01, 1.100986e+00, 1.339889e+00, 2.576769e+00,
                             1.357909e-01, 9.916934e-01, 1.307459e+00
                         ],
                         [
                             1.877741e-01, 1.404975e+00, 4.656824e-01, 3.037293e-01, 1.425353e+00,
                             7.387969e-01, 2.822495e-01, 2.160520e+00
                         ],
                         [
                             2.071941e-01, 6.181923e-01, 3.518773e-01, 4.743503e-01, 1.866477e+00,
                             4.828736e-01, 3.527590e-01, 6.698488e-01
                         ],
                         [
                             6.038610e-01, 5.546872e-01, 2.656380e-01, 2.286343e+00, 2.392633e+00,
                             7.650474e-01, 4.435100e-01, 7.801089e-01
                         ],
                         [
                             5.805574e-02, 5.161967e-01, 6.254389e-01, 1.140153e-01, 4.602900e-01,
                             1.545453e+00, 9.239465e-01, 1.856298e+00
                         ],
                         [
                             9.274518e-01, 7.343768e-01, 7.131039e-02, 4.846255e-01, 3.234485e-01,
                             5.484174e-01, 1.105464e+00, 1.278224e+00
                         ],
                         [
                             1.556910e+00, 3.666997e-01, 1.662685e+00, 1.441152e-01, 3.756307e-01,
                             8.958459e-01, 4.927008e-01, 7.573250e-01
                         ],
                         [
                             9.281902e-01, 2.886130e-01, 1.010901e+00, 2.218724e-01, 7.626836e-01,
                             2.481078e-01, 1.715915e+00, 6.205620e-01
                         ],
                         [
                             9.719175e-01, 9.987950e-02, 6.216875e-01, 2.874449e-01, 1.215398e+00,
                             7.141964e-01, 1.508863e+00, 2.104115e+00
                         ],
                         [
                             6.186044e-01, 1.255446e-01, 1.177350e+00, 1.768443e+00, 1.203693e+00,
                             1.307723e+00, 5.749086e-01, 1.035300e+00
                         ],
                         [
                             1.358697e+00, 2.592989e-01, 7.982719e-01, 5.372682e-01, 1.414839e+00,
                             9.188377e-01, 9.750985e-01, 8.615064e-02
                         ],
                         [
                             3.449626e-01, 1.998185e+00, 1.645385e+00, 6.096146e-01, 3.693044e-01,
                             2.575221e-01, 6.614220e-01, 3.641906e-01
                         ],
                         [
                             3.541521e-01, 1.576332e+00, 1.058699e+00, 4.505666e-01, 3.511740e-01,
                             1.149603e+00, 2.161716e+00, 6.253461e-01
                         ],
                         [
                             2.615604e-01, 1.488932e-01, 3.193125e-01, 1.261494e+00, 1.112915e+00,
                             1.357315e+00, 8.968256e-01, 4.076732e-01
                         ],
                         [
                             2.007156e+00, 1.745405e-01, 1.135348e+00, 6.381167e-01, 7.625421e-01,
                             1.367947e+00, 4.253699e-01, 2.712192e-01
                         ],
                         [
                             3.292915e-01, 1.019294e+00, 8.846284e-01, 2.073622e+00, 1.216256e+00,
                             1.511842e+00, 6.264387e-01, 4.345445e-01
                         ],
                         [
                             1.049057e+00, 8.398259e-01, 1.794139e+00, 1.976886e-01, 1.734895e+00,
                             4.877771e-02, 8.300084e-01, 1.802579e-01
                         ],
                         [
                             5.156100e-01, 2.295642e-01, 1.078938e+00, 9.767285e-01, 4.056123e-01,
                             1.586712e+00, 9.254451e-01, 2.250692e-01
                         ],
                         [
                             4.580702e-01, 5.550582e-01, 3.471642e-01, 2.261801e-01, 2.467296e-01,
                             4.466101e-01, 6.326124e-01, 6.356320e-01
                         ],
                         [
                             8.596763e-01, 1.778582e+00, 4.314474e-01, 1.982944e+00, 1.373579e-01,
                             7.160507e-01, 1.245597e+00, 4.440241e-01
                         ],
                         [
                             1.349948e+00, 6.334998e-01, 8.185495e-01, 6.030746e-01, 4.139718e-01,
                             1.748299e+00, 1.200866e+00, 9.191986e-01
                         ],
                         [
                             1.556917e-01, 1.614663e-01, 5.103067e-01, 7.382916e-01, 6.088558e-01,
                             6.675653e-01, 2.244494e-01, 3.019792e-01
                         ],
                         [
                             2.095181e+00, 1.340057e+00, 8.555296e-01, 9.203696e-01, 3.299997e-01,
                             6.386341e-01, 1.972312e+00, 1.949875e-01
                         ],
                         [
                             4.948469e-01, 6.618763e-01, 1.672577e+00, 1.495349e+00, 1.273729e+00,
                             5.885103e-01, 5.795857e-01, 2.867540e-01
                         ],
                         [
                             2.062668e-01, 6.960700e-01, 5.272485e-01, 1.489507e+00, 1.077074e+00,
                             9.936657e-02, 7.631031e-01, 3.694195e-01
                         ],
                         [
                             1.289447e+00, 1.093231e+00, 2.416466e+00, 6.484286e-01, 7.968459e-01,
                             1.914732e-01, 1.493050e+00, 7.603273e-01
                         ],
                         [
                             4.513705e-02, 8.069828e-01, 6.068417e-01, 5.728740e-01, 3.171813e-01,
                             6.228923e-01, 1.844457e-01, 1.387310e+00
                         ],
                         [
                             1.491091e-01, 3.361238e-01, 7.950770e-01, 4.399583e-01, 4.560006e-01,
                             5.885327e-01, 1.543922e+00, 7.970116e-01
                         ],
                         [
                             5.713322e-01, 1.739685e+00, 1.587724e+00, 5.537099e-01, 6.681887e-01,
                             2.773290e-01, 5.560229e-01, 6.660519e-01
                         ],
                         [
                             4.621969e-01, 2.220495e+00, 1.382688e+00, 5.998626e-01, 1.464076e+00,
                             1.472559e+00, 9.332619e-01, 9.526173e-01
                         ],
                         [
                             2.304937e+00, 2.408259e-01, 3.738552e-01, 4.836636e-01, 9.244279e-01,
                             9.309573e-01, 7.971221e-01, 8.831339e-01
                         ],
                         [
                             2.616065e-01, 5.354907e-01, 2.264695e+00, 4.548186e-01, 2.008204e+00,
                             1.239446e+00, 1.050684e+00, 5.046744e-01
                         ],
                         [
                             2.696674e-01, 2.551384e-01, 5.799770e-01, 7.839062e-01, 1.302692e+00,
                             1.661586e+00, 1.604069e-01, 1.443489e+00
                         ],
                         [
                             5.544761e-01, 1.054490e+00, 6.618498e-01, 7.775080e-01, 1.054462e+00,
                             8.055046e-01, 9.428422e-01, 1.826911e+00
                         ],
                         [
                             1.390665e+00, 4.955834e-01, 6.344773e-01, 1.458103e+00, 1.082084e+00,
                             4.683924e-01, 2.987354e-01, 4.235713e-01
                         ],
                         [
                             9.420367e-01, 2.779442e-01, 2.972134e-01, 8.192492e-02, 8.289418e-01,
                             4.528348e-01, 2.558508e+00, 5.205940e-02
                         ],
                         [
                             3.556699e-01, 1.847399e+00, 4.201973e-01, 1.491812e+00, 8.014433e-01,
                             1.738397e+00, 1.425845e+00, 3.614524e-01
                         ],
                         [
                             1.865800e+00, 1.650196e+00, 1.115965e+00, 8.757570e-01, 6.317505e-01,
                             3.679276e-01, 9.205696e-01, 1.036604e-01
                         ],
                         [
                             1.120361e+00, 4.515254e-01, 4.700845e-01, 2.102993e+00, 2.946910e-01,
                             5.301031e-01, 7.386650e-01, 1.247083e+00
                         ],
                         [
                             7.836180e-01, 6.594499e-01, 2.370939e-01, 2.411295e+00, 6.408466e-01,
                             2.589362e-01, 1.544287e+00, 1.075979e+00
                         ],
                         [
                             5.744736e-02, 8.757442e-01, 2.781247e-01, 5.798813e-01, 8.198041e-01,
                             4.913662e-01, 1.436830e+00, 6.147962e-01
                         ],
                         [
                             1.344765e+00, 1.976323e-01, 9.170440e-01, 5.442823e-01, 7.145720e-01,
                             5.421553e-01, 6.714385e-01, 1.602483e+00
                         ],
                         [
                             5.784870e-01, 2.067036e+00, 4.336340e-01, 1.205363e+00, 9.800541e-01,
                             3.371547e-01, 6.883633e-01, 5.008709e-01
                         ],
                         [
                             8.449938e-01, 3.898522e-01, 7.415525e-02, 9.201568e-01, 2.184103e+00,
                             4.848561e-01, 2.544621e+00, 7.629209e-01
                         ],
                         [
                             1.466158e+00, 2.334652e-01, 7.427089e-01, 6.472785e-01, 5.447986e-01,
                             5.750405e-01, 3.118475e-01, 8.411428e-02
                         ],
                         [
                             6.785990e-01, 1.020199e+00, 4.318230e-01, 1.364990e+00, 2.574320e-01,
                             1.606841e+00, 7.629657e-01, 1.093544e+00
                         ],
                         [
                             1.634181e+00, 6.981029e-01, 3.070491e-01, 4.652515e-01, 1.993209e+00,
                             6.652508e-01, 7.474141e-01, 6.931301e-01
                         ],
                         [
                             5.861689e-01, 1.139087e+00, 3.056830e-01, 3.562531e-01, 1.094878e+00,
                             1.324490e-01, 2.922954e-01, 5.533282e-01
                         ],
                         [
                             1.271053e+00, 4.980005e-01, 1.198979e+00, 5.815380e-01, 5.985447e-01,
                             5.316797e-01, 1.254389e+00, 1.003270e-01
                         ],
                         [
                             6.422041e-01, 3.371116e-01, 4.425761e-01, 1.073979e+00, 6.183553e-01,
                             3.193260e-01, 6.734103e-01, 2.469719e+00
                         ],
                         [
                             6.108826e-01, 1.152949e+00, 1.786691e-01, 1.229684e+00, 1.303669e+00,
                             1.181956e+00, 9.045857e-01, 2.778997e-01
                         ],
                         [
                             8.546749e-01, 1.623641e+00, 1.113997e+00, 5.463167e-01, 8.094007e-01,
                             8.165118e-01, 2.144244e-01, 1.463341e+00
                         ],
                         [
                             2.117100e-01, 1.233891e+00, 3.102403e-01, 2.086298e-01, 2.978814e-01,
                             1.393871e+00, 5.577747e-01, 7.408023e-01
                         ],
                         [
                             1.587661e+00, 1.968152e-01, 5.743356e-01, 2.421620e-01, 6.707188e-01,
                             1.160832e-01, 9.838474e-01, 1.003291e+00
                         ],
                         [
                             1.237471e+00, 8.857128e-01, 1.217633e+00, 4.812241e-01, 1.096038e+00,
                             4.775530e-01, 1.134567e-01, 5.457250e-01
                         ],
                         [
                             8.895231e-01, 7.605388e-01, 5.228415e-01, 3.146199e-01, 1.498681e-01,
                             9.871113e-01, 1.625248e+00, 6.528564e-01
                         ],
                         [
                             1.630183e+00, 9.488980e-01, 5.495870e-01, 8.509189e-01, 1.129096e+00,
                             6.894432e-01, 6.082581e-01, 7.332673e-01
                         ],
                         [
                             8.009511e-01, 6.393099e-01, 1.274106e+00, 2.333492e+00, 1.331258e-01,
                             3.887380e-01, 1.194753e+00, 7.108503e-01
                         ],
                         [
                             9.250267e-01, 2.265109e+00, 6.275841e-01, 1.092811e+00, 3.792427e-01,
                             9.522420e-02, 1.312143e-01, 1.502728e+00
                         ],
                         [
                             3.610975e-01, 1.873665e+00, 1.139644e+00, 4.162343e-01, 6.368699e-01,
                             1.435392e+00, 5.470510e-01, 2.270700e-01
                         ],
                         [
                             3.490135e-01, 3.417220e-01, 1.706519e+00, 7.902858e-01, 2.822175e-01,
                             9.651042e-01, 4.930483e-01, 4.198628e-01
                         ],
                         [
                             2.131094e+00, 8.899492e-01, 1.020584e-01, 6.102246e-01, 3.532643e-01,
                             1.170475e-01, 1.183286e+00, 4.667630e-01
                         ],
                         [
                             5.047951e-01, 6.202130e-02, 1.492148e-01, 2.556705e-01, 4.213193e-01,
                             9.036848e-01, 6.802403e-01, 1.929024e+00
                         ],
                         [
                             4.148270e-01, 2.553253e-01, 8.683561e-01, 4.634669e-01, 4.228547e-01,
                             2.333387e+00, 5.845444e-01, 1.509658e+00
                         ],
                         [
                             1.035829e+00, 2.743948e-01, 5.550681e-01, 1.332478e+00, 1.310305e+00,
                             9.035264e-01, 1.071682e-02, 2.095119e+00
                         ],
                         [
                             1.209520e+00, 8.617605e-02, 3.762010e-01, 1.931844e+00, 8.323944e-01,
                             1.445438e+00, 1.124274e+00, 6.149595e-01
                         ],
                         [
                             1.950489e+00, 1.053679e+00, 1.543999e+00, 1.487204e+00, 1.854876e+00,
                             1.328196e+00, 6.099797e-01, 6.745501e-01
                         ],
                         [
                             6.513095e-01, 4.476272e-01, 1.614560e+00, 2.648232e-02, 4.848455e-01,
                             1.006206e+00, 5.481483e-01, 1.672597e+00
                         ],
                         [
                             4.146878e-01, 1.231174e+00, 2.400441e-01, 3.677568e-01, 3.547702e-01,
                             3.339457e-01, 7.447379e-01, 1.323662e+00
                         ],
                         [
                             3.583706e-01, 1.804315e-01, 2.654060e-01, 5.640455e-01, 5.412312e-01,
                             4.309441e-01, 2.335244e+00, 3.816709e-01
                         ],
                         [
                             1.864141e+00, 1.060274e+00, 3.755774e-01, 9.393798e-01, 1.191743e+00,
                             1.699055e+00, 7.701576e-01, 7.730513e-01
                         ],
                         [
                             7.189382e-01, 1.271915e-01, 3.265222e-01, 4.066033e-01, 1.139497e-01,
                             1.614911e+00, 3.762277e-01, 7.576289e-01
                         ],
                         [
                             9.201671e-01, 2.574003e+00, 5.434186e-01, 1.108824e+00, 5.110165e-01,
                             9.723849e-01, 4.910820e-01, 9.743661e-01
                         ],
                         [
                             1.646692e+00, 1.124774e+00, 1.036944e+00, 1.056463e+00, 8.468713e-01,
                             9.082918e-01, 4.046302e-01, 1.442988e+00
                         ],
                         [
                             8.380201e-01, 2.843196e-01, 5.296828e-01, 2.243665e-01, 8.505139e-01,
                             3.320460e-01, 8.993124e-02, 3.377139e-01
                         ],
                         [
                             2.572942e-01, 4.080040e-01, 3.601840e-01, 1.681349e+00, 1.685464e-01,
                             4.871483e-01, 6.835515e-01, 6.745066e-01
                         ],
                         [
                             8.934132e-01, 5.289776e-01, 1.032849e+00, 6.130036e-01, 2.575280e+00,
                             8.054180e-01, 1.201991e+00, 3.895916e-01
                         ],
                         [
                             4.961194e-01, 2.441363e-01, 1.511683e+00, 4.000590e-01, 1.371733e+00,
                             9.988364e-01, 4.330208e-01, 7.090552e-01
                         ],
                         [
                             9.520397e-02, 1.060032e+00, 7.362195e-01, 1.597775e+00, 4.042713e-01,
                             4.573445e-01, 4.172380e-01, 3.330669e-01
                         ],
                         [
                             7.850377e-01, 3.334540e-01, 2.700910e-01, 1.548841e+00, 5.610195e-01,
                             2.333778e+00, 2.444569e-01, 2.062127e-01
                         ],
                         [
                             3.856694e-01, 2.996702e-01, 9.892898e-01, 1.233599e+00, 2.759893e-01,
                             1.230895e+00, 6.878129e-01, 1.725537e+00
                         ],
                         [
                             4.219237e-01, 4.476180e-01, 1.594566e+00, 5.783762e-02, 1.529665e+00,
                             5.313554e-01, 1.868352e+00, 3.367031e-01
                         ],
                         [
                             2.121766e+00, 6.024154e-01, 5.515411e-01, 2.660017e+00, 9.150254e-01,
                             9.865979e-01, 8.861908e-01, 9.950553e-01
                         ],
                         [
                             3.705733e-01, 6.146460e-01, 2.694915e-01, 9.988717e-01, 6.705269e-01,
                             3.112390e+00, 1.243945e+00, 1.884727e-01
                         ],
                         [
                             1.575335e+00, 9.365977e-01, 4.352161e-01, 1.185849e+00, 1.989172e+00,
                             1.151674e+00, 1.703091e+00, 1.358091e-01
                         ],
                         [
                             3.537230e-01, 1.612351e+00, 1.562192e+00, 7.893901e-01, 9.759325e-02,
                             4.652816e-01, 5.593050e-01, 1.719409e+00
                         ],
                         [
                             1.211770e-01, 2.513536e-01, 3.235835e-01, 3.142996e-01, 7.566348e-01,
                             1.081331e+00, 1.262757e+00, 1.460621e-01
                         ],
                         [
                             5.000385e-01, 8.622953e-01, 2.068608e+00, 4.402356e-01, 9.764172e-01,
                             4.047541e-01, 9.138218e-01, 1.656350e+00
                         ],
                         [
                             1.366131e-01, 6.311917e-01, 1.025071e+00, 4.925700e-03, 3.196537e-01,
                             7.673617e-01, 2.689428e-01, 8.492768e-01
                         ],
                         [
                             8.632370e-01, 8.043571e-01, 2.109220e-01, 7.885987e-01, 1.303799e+00,
                             7.052767e-01, 1.476172e+00, 8.584453e-01
                         ],
                         [
                             2.657543e-01, 9.727680e-01, 1.358957e+00, 9.708462e-01, 9.243132e-01,
                             4.627251e-01, 1.522538e+00, 7.542951e-01
                         ],
                         [
                             6.045744e-01, 4.428597e-01, 2.636328e+00, 3.729434e-01, 4.251686e-01,
                             1.099118e+00, 2.989758e-01, 1.971635e-01
                         ],
                         [
                             3.483359e-02, 1.581410e+00, 4.759454e-01, 4.313482e-02, 1.578314e+00,
                             6.918450e-01, 1.109636e+00, 9.535634e-01
                         ],
                         [
                             2.244268e-01, 4.787244e-01, 9.783738e-01, 1.563672e-01, 9.586653e-01,
                             3.525319e-01, 3.108776e-01, 7.904224e-01
                         ],
                         [
                             7.108459e-01, 6.803842e-01, 7.169851e-01, 1.555068e+00, 1.555524e+00,
                             4.896397e-01, 1.610320e+00, 1.505541e+00
                         ],
                         [
                             8.783502e-01, 9.953656e-01, 3.255121e-01, 1.181988e+00, 4.942545e-01,
                             1.761891e+00, 3.383998e-01, 4.979811e-01
                         ],
                         [
                             1.355861e+00, 1.042444e+00, 1.208749e+00, 4.383207e-01, 2.647908e-01,
                             5.151029e-01, 5.410691e-01, 1.640185e+00
                         ],
                         [
                             3.707729e-01, 2.861516e-01, 9.498804e-01, 4.490879e-01, 1.707480e+00,
                             9.652718e-01, 2.340544e-01, 1.193855e+00
                         ],
                         [
                             6.605411e-01, 1.583792e+00, 1.497273e+00, 1.465441e+00, 2.403834e-01,
                             2.141321e-01, 1.058506e+00, 1.197430e+00
                         ],
                         [
                             1.301488e+00, 1.802285e+00, 2.931077e-01, 8.631967e-01, 1.352952e+00,
                             6.017865e-01, 9.890580e-01, 7.530783e-01
                         ],
                         [
                             3.316958e-03, 1.259712e+00, 1.269550e-01, 1.097668e+00, 1.648491e-01,
                             3.392208e-01, 1.042425e+00, 1.586050e+00
                         ],
                         [
                             5.679255e-01, 2.812013e-01, 1.098138e+00, 2.663904e-01, 3.408125e-01,
                             1.212515e+00, 1.827176e+00, 8.423777e-01
                         ],
                         [
                             9.346566e-01, 1.092434e+00, 5.695174e-01, 5.352271e-01, 1.454518e+00,
                             3.912508e-01, 4.452395e-01, 1.266594e-01
                         ],
                         [
                             3.929470e-01, 5.391529e-02, 6.651140e-01, 3.953631e-01, 2.750529e-01,
                             2.330342e-01, 5.135534e-01, 4.100941e-01
                         ],
                         [
                             3.246791e-01, 8.439642e-01, 2.849638e-01, 7.240639e-01, 1.104084e+00,
                             6.050713e-01, 1.137610e-01, 1.063508e+00
                         ],
                         [
                             1.317963e+00, 8.453359e-01, 7.682408e-01, 7.728379e-01, 8.722353e-01,
                             1.410625e+00, 2.203856e+00, 1.207412e-01
                         ],
                         [
                             6.692902e-01, 8.949711e-01, 6.369507e-01, 6.656163e-01, 5.258453e-01,
                             1.836237e+00, 1.394260e+00, 8.596742e-01
                         ],
                         [
                             1.461898e+00, 8.814931e-01, 1.866804e+00, 1.856167e-02, 1.182768e+00,
                             1.682116e+00, 1.435932e+00, 1.230817e+00
                         ],
                         [
                             5.122987e-01, 8.537447e-01, 2.642197e-01, 3.237115e-01, 6.057248e-01,
                             1.913608e+00, 2.566555e-01, 1.026225e+00
                         ],
                         [
                             1.739634e+00, 1.179504e+00, 5.969492e-01, 1.433108e+00, 2.216000e+00,
                             3.586518e-01, 2.805901e-01, 6.857328e-01
                         ],
                         [
                             1.066792e+00, 1.273982e-01, 7.749190e-01, 1.815933e+00, 1.403479e+00,
                             4.618966e-01, 1.462899e+00, 2.844549e-01
                         ],
                         [
                             9.934146e-01, 8.126070e-01, 1.889450e+00, 1.725654e+00, 6.433750e-01,
                             1.827488e+00, 1.284724e+00, 2.188096e-01
                         ],
                         [
                             1.096672e-01, 1.196566e+00, 1.976246e+00, 4.236726e-01, 3.909784e-01,
                             1.289189e+00, 1.111987e+00, 1.229248e+00
                         ],
                         [
                             2.217637e-01, 6.657760e-01, 6.262805e-01, 9.191880e-01, 1.275509e+00,
                             8.219794e-01, 7.896019e-01, 2.890634e+00
                         ],
                         [
                             1.174162e+00, 4.438379e-01, 2.635722e-01, 1.381778e+00, 4.933126e-01,
                             5.370386e-01, 1.299924e+00, 6.855111e-01
                         ],
                         [
                             8.613244e-01, 1.059417e+00, 4.611966e-01, 5.468963e-02, 1.394264e+00,
                             7.898584e-01, 2.436107e+00, 1.051381e+00
                         ],
                         [
                             4.960465e-01, 3.688982e-01, 1.841706e+00, 1.307497e+00, 1.070522e+00,
                             3.874640e-02, 2.633433e+00, 5.486703e-01
                         ],
                         [
                             7.154356e-01, 2.607383e-01, 1.067244e+00, 2.720703e-01, 2.126789e-01,
                             1.088930e+00, 2.816740e-01, 2.483017e-01
                         ],
                         [
                             1.008186e-01, 5.065903e-01, 6.832736e-01, 2.291145e+00, 9.115478e-01,
                             1.091967e+00, 1.718324e+00, 1.017462e+00
                         ],
                         [
                             7.198595e-01, 7.115148e-01, 2.866555e-01, 1.748414e-01, 1.500937e+00,
                             1.901444e+00, 6.020143e-01, 5.061114e-01
                         ],
                         [
                             1.623075e+00, 5.861114e-01, 2.393469e-01, 1.152252e+00, 1.191668e+00,
                             2.409594e-01, 1.202390e-01, 1.615194e+00
                         ],
                         [
                             4.925214e-01, 8.764223e-01, 3.029478e-01, 9.296824e-01, 4.402451e-01,
                             1.542502e-01, 1.074500e+00, 7.523198e-01
                         ],
                         [
                             1.301556e+00, 4.149913e-01, 1.937515e-01, 7.210627e-01, 6.889999e-01,
                             1.108295e+00, 5.181387e-01, 2.634616e-01
                         ],
                         [
                             9.547497e-01, 8.953716e-01, 6.273335e-01, 5.369796e-01, 1.298495e+00,
                             3.515699e-01, 1.966971e+00, 1.966131e-01
                         ],
                         [
                             2.091214e+00, 5.630321e-01, 4.302607e-01, 1.617163e+00, 4.063204e-01,
                             9.069679e-01, 5.225648e-01, 1.451849e+00
                         ],
                         [
                             3.023866e-01, 6.228716e-01, 1.023614e+00, 1.785561e-01, 6.266932e-01,
                             3.095968e-01, 9.301599e-01, 3.814704e-01
                         ],
                         [
                             6.783455e-01, 2.459494e+00, 6.026602e-01, 3.752297e-01, 1.445095e-01,
                             7.581810e-01, 1.317526e+00, 1.240277e-01
                         ],
                         [
                             8.859552e-01, 1.229371e+00, 1.092990e+00, 4.693397e-01, 3.741996e-01,
                             9.593899e-01, 7.279094e-01, 4.275255e-01
                         ],
                         [
                             6.604333e-01, 1.150326e+00, 6.722526e-01, 5.030856e-01, 1.394172e+00,
                             1.127676e+00, 1.908986e-01, 4.657117e-01
                         ],
                         [
                             1.156106e+00, 4.325342e-01, 3.369241e-01, 1.022902e+00, 7.095266e-02,
                             7.529686e-01, 2.422900e-01, 9.971448e-02
                         ],
                         [
                             1.162465e+00, 1.201565e+00, 5.517620e-01, 7.656447e-01, 2.755123e-01,
                             9.201373e-01, 2.544122e-01, 8.140167e-01
                         ],
                         [
                             7.380129e-01, 7.863452e-01, 2.388133e+00, 2.533214e-01, 6.470381e-01,
                             6.285137e-01, 1.719620e+00, 6.620744e-02
                         ],
                         [
                             1.633473e+00, 1.734332e+00, 4.256781e-01, 5.882371e-01, 1.004733e+00,
                             1.316083e+00, 7.550695e-01, 2.555308e+00
                         ],
                         [
                             8.574278e-01, 1.922579e+00, 6.274188e-01, 9.209219e-01, 2.102700e+00,
                             6.290014e-01, 1.606005e+00, 9.124593e-01
                         ],
                         [
                             1.026998e+00, 3.999332e-01, 1.720683e-01, 1.428703e+00, 8.037854e-01,
                             8.523914e-01, 2.113382e-01, 1.272084e+00
                         ],
                         [
                             5.880936e-01, 9.841986e-01, 2.615733e+00, 2.152178e-01, 3.940796e-01,
                             1.064919e-01, 5.034714e-01, 5.395540e-01
                         ],
                         [
                             1.246708e+00, 8.465223e-01, 2.679594e-01, 2.514443e-01, 5.683188e-01,
                             1.564777e-01, 5.565277e-01, 6.868690e-02
                         ],
                         [
                             3.049056e+00, 1.090675e+00, 3.318772e-01, 7.290460e-01, 3.525287e-01,
                             3.114801e-01, 1.000746e+00, 3.631257e-01
                         ],
                         [
                             1.183319e+00, 5.881420e-01, 8.085696e-01, 1.034831e+00, 2.442984e-01,
                             3.370079e-01, 1.888096e-01, 2.376334e-01
                         ],
                         [
                             1.893729e+00, 5.015892e-01, 1.012908e+00, 2.058787e+00, 7.143413e-01,
                             6.869862e-01, 6.835587e-01, 3.655501e-01
                         ],
                         [
                             1.130469e-01, 2.633701e-01, 6.130239e-01, 7.329410e-01, 1.667668e+00,
                             3.942964e-01, 1.741428e+00, 1.510399e+00
                         ],
                         [
                             6.790290e-01, 2.109857e-01, 1.219887e+00, 1.084524e+00, 6.481099e-01,
                             1.662130e+00, 2.048834e-01, 8.172332e-01
                         ],
                         [
                             3.129461e-01, 5.784740e-01, 5.849307e-01, 1.307997e-01, 2.212984e+00,
                             4.119945e-01, 1.573296e+00, 8.041529e-01
                         ],
                         [
                             1.355775e+00, 1.203402e+00, 3.701879e-01, 1.002787e+00, 3.207141e-01,
                             1.847171e-01, 6.648278e-01, 1.854792e+00
                         ],
                         [
                             1.039290e+00, 1.819679e-01, 6.197267e-01, 8.605411e-01, 8.776498e-02,
                             1.305855e+00, 3.066423e-01, 2.425916e+00
                         ],
                         [
                             2.505991e-01, 2.696637e+00, 3.225341e-01, 8.282344e-01, 9.001949e-01,
                             8.433164e-01, 3.026595e-01, 1.291940e+00
                         ],
                         [
                             1.329237e+00, 2.561538e-01, 1.789487e+00, 6.074338e-01, 8.773405e-01,
                             4.230743e-01, 5.181779e-01, 6.003891e-01
                         ],
                         [
                             1.114484e+00, 9.626424e-01, 1.762448e+00, 1.354037e+00, 1.059091e+00,
                             5.290744e-02, 3.582094e-01, 2.059051e+00
                         ],
                         [
                             2.854509e-01, 9.655388e-01, 6.763020e-01, 5.800812e-01, 4.740470e-01,
                             6.499642e-01, 1.116624e+00, 1.592209e+00
                         ],
                         [
                             2.194575e-01, 2.587394e-01, 3.449749e-01, 1.316123e+00, 3.840106e-01,
                             1.584694e+00, 1.823699e+00, 3.830892e-01
                         ],
                         [
                             6.943398e-01, 2.855002e+00, 1.085454e+00, 1.490254e+00, 6.532288e-01,
                             4.265703e-01, 1.350129e+00, 1.127819e+00
                         ],
                         [
                             5.706875e-01, 3.748437e-01, 1.205003e+00, 4.152895e-01, 3.869399e-01,
                             3.728028e-01, 4.488939e-01, 1.175151e+00
                         ],
                         [
                             3.457468e-01, 2.741879e-01, 5.443432e-01, 4.623206e-02, 1.124970e+00,
                             1.050502e+00, 4.787862e-01, 9.160287e-01
                         ],
                         [
                             5.117102e-01, 8.450135e-02, 1.989321e+00, 8.673171e-01, 5.420002e-01,
                             1.105992e+00, 1.650224e+00, 5.488055e-01
                         ],
                         [
                             4.716862e-01, 1.562785e-01, 9.760353e-02, 1.358276e-01, 6.989390e-01,
                             2.166363e-01, 3.179211e-01, 1.000766e+00
                         ],
                         [
                             9.912302e-01, 6.579270e-01, 1.028163e+00, 9.857855e-01, 2.173722e+00,
                             5.210859e-01, 5.469975e-01, 3.538097e-01
                         ],
                         [
                             1.718905e-01, 7.084076e-01, 6.813257e-01, 9.313000e-01, 3.694140e-02,
                             3.525347e-01, 9.138586e-01, 1.059732e-01
                         ],
                         [
                             4.214648e-01, 7.762671e-01, 1.470560e+00, 7.979597e-01, 3.283856e-01,
                             5.548123e-01, 1.616895e+00, 3.200003e+00
                         ],
                         [
                             2.437713e+00, 1.511148e+00, 9.184858e-01, 6.090460e-01, 2.178388e+00,
                             2.468885e-01, 5.435504e-01, 5.623624e-01
                         ],
                         [
                             2.606019e-01, 4.097764e-01, 4.080524e-01, 1.032322e+00, 2.766200e-01,
                             7.212380e-01, 1.098504e+00, 2.351692e-01
                         ],
                         [
                             6.661513e-01, 1.604131e-01, 5.948913e-01, 1.360330e-01, 1.327613e+00,
                             1.166661e+00, 6.005388e-01, 9.015585e-02
                         ],
                         [
                             1.447469e+00, 2.422439e-01, 1.982070e-01, 1.234340e+00, 5.877689e-01,
                             7.673308e-01, 2.391132e+00, 1.151360e+00
                         ],
                         [
                             3.884865e-01, 3.140824e-01, 4.512492e-01, 6.836270e-01, 1.210604e+00,
                             7.229572e-01, 4.167802e-01, 2.021642e+00
                         ],
                         [
                             2.260853e+00, 1.800556e+00, 8.188159e-02, 2.333331e-01, 6.525316e-01,
                             4.738984e-01, 6.925994e-01, 2.816951e-02
                         ],
                         [
                             2.490179e-01, 1.200238e+00, 9.900093e-01, 2.998951e-01, 3.092660e-01,
                             7.582628e-01, 2.295088e-01, 2.237956e-01
                         ],
                         [
                             2.401376e+00, 5.572953e-01, 1.038627e+00, 6.037223e-01, 2.210260e-01,
                             3.912885e-01, 6.383400e-01, 1.746023e+00
                         ],
                         [
                             8.323200e-01, 1.836559e-01, 1.339787e+00, 8.352807e-01, 8.135442e-01,
                             2.248449e+00, 9.453309e-01, 2.112882e+00
                         ],
                         [
                             8.754492e-01, 1.618462e-01, 7.521608e-01, 7.991629e-01, 1.971338e+00,
                             1.289098e+00, 6.431125e-01, 1.537024e+00
                         ],
                         [
                             3.784914e-01, 1.002756e+00, 1.616635e+00, 2.135753e+00, 3.923859e-01,
                             7.392413e-01, 3.604279e-02, 4.504573e-01
                         ],
                         [
                             5.947381e-01, 1.280172e+00, 3.954008e-01, 1.234528e+00, 1.644423e+00,
                             9.052544e-01, 5.406512e-01, 7.398933e-01
                         ],
                         [
                             2.213749e+00, 4.566813e-01, 1.208754e+00, 4.914090e-01, 8.667633e-01,
                             1.646256e+00, 9.162506e-01, 3.378832e-01
                         ],
                         [
                             1.251393e+00, 1.005191e+00, 4.259180e-01, 1.679652e+00, 4.724747e-01,
                             2.265397e+00, 4.267687e-01, 1.530254e+00
                         ],
                         [
                             1.475509e+00, 8.271381e-02, 1.756854e+00, 1.475345e+00, 2.707592e-01,
                             1.127558e+00, 7.625000e-01, 4.287958e-01
                         ],
                         [
                             5.768607e-01, 1.920797e+00, 2.507611e+00, 9.455148e-01, 7.733566e-01,
                             4.744107e-01, 2.768162e-01, 6.561392e-01
                         ]])


def get_grid():
    signs = torch.cartesian_prod(*[torch.tensor([-1, 1])] * _KM8C_CODESZ)
    outer = signs.unsqueeze(0) * get_abs_grid().unsqueeze(1)
    return outer.reshape(-1, _KM8C_CODESZ)


_KM8C_GRID = get_grid()
_KM8C_GRID_NORM = torch.diag(_KM8C_GRID @ _KM8C_GRID.T)


class kmedoid_8col(nn.Module):

    def __init__(self, build_truncated=True):
        super(kmedoid_8col, self).__init__()
        self.register_buffer('grid', _KM8C_GRID)
        self.register_buffer('grid_norm', _KM8C_GRID_NORM)

        self.opt_scale = 1.0
        self.codesz = _KM8C_CODESZ
        self.idx_dtype = torch.int16
        self.idx_offset = -2**15

        if build_truncated:
            # 256 entries
            self.register_buffer('grid_part', get_abs_grid())
            self.register_buffer('grid_part_norm', torch.diag(self.grid_part @ self.grid_part.T))
            self.register_buffer('int_map', 2**torch.arange(_KM8C_CODESZ))

    def round(self, X, grid, grid_norm):
        assert X.shape[-1] == self.codesz
        Xqidx = (2 * X @ grid.T - grid_norm).argmax(-1)
        return grid[Xqidx], Xqidx

    def quantize(self, X, return_idx=True):
        flips = self.to_int(X < 0) << 8
        mask = 1 - 2 * (X < 0).to(torch.float32)

        X_part = torch.abs(X)
        roundout, Xqidx = self.round(X_part, self.grid_part, self.grid_part_norm)
        vals = roundout * mask
        if not return_idx:
            return vals
        return vals, (flips + Xqidx + self.idx_offset).to(self.idx_dtype)

    def to_int(self, mask):
        return (self.int_map.unsqueeze(0) * mask.int()).sum(dim=-1)

    def to_mask(self, int):
        return 1 - 2 * ((self.int_map & int.unsqueeze(-1)) > 0)

    def by_idxs(self, idxs):
        idxs = idxs.int() - self.idx_offset
        mask = self.to_mask(idxs >> 8)
        return self.grid_part[idxs & 255] * mask


class KMedoid8ColLinear(nn.Module):

    def __init__(self, device):
        super().__init__()
        self.codebook = kmedoid_8col().to(torch.float16).to(device)

    def forward(self,
                input,
                Qidxs,
                SU,
                SV,
                Wscale,
                rank=-1,
                A=None,
                B=None,
                rescale_WH=False,
                scaleWH=None):
        (m, n) = Qidxs.shape

        x = input.view(-1, n * _KM8C_CODESZ).to(torch.float32)
        if rescale_WH:
            x /= scaleWH
        x = x * SU
        x = matmul_hadUt_cuda(x)

        if rank > 0:
            Bx = x @ B.t().to(torch.float32)
            ABx = Bx @ A.t().to(torch.float32)

        num_scale = 1024
        x = x / num_scale
        x = x.to(torch.float16)

        W_decompressed = self.codebook.by_idxs(Qidxs).reshape(-1, n * _KM8C_CODESZ)
        z = x @ W_decompressed.t()

        x = z.to(torch.float32)
        x = x * (Wscale * num_scale)

        if rank > 0:
            x = x + ABx.to(torch.float32)

        x = matmul_hadU_cuda(x)
        x = x * SV

        output = x.view(*input.shape[:-1], m)

        return output
